---
title: "a3_task3_leonardo_feitosa"
author: "Leonardo Feitosa"
date: "18/02/2021"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidytext)
library(textdata)
library(pdftools)
library(ggwordcloud)
library(here)
```

## Read in the data 

```{r, cache = TRUE}
sherlock_text <- pdf_text(here("data", "sherlock.pdf"))

sherlock_text_p50 <- sherlock_text[50]
```

## Wrangling text

```{r}
sherlock_text_tidy <- data.frame(sherlock_text) %>% 
  mutate(text_full = str_split(sherlock_text, pattern = "\\r\n")) %>% 
  unnest(text_full) %>% 
  mutate(text_full = str_squish(text_full))
```


## Tidying the data

```{r}
sherlock_df <- sherlock_text_tidy %>% 
  slice(-(1:34)) %>% 
  mutate(part = case_when(
    str_detect(text_full, "Part") ~ text_full,
    TRUE ~ NA_character_
  )) %>% 
  fill(part) %>% 
  separate(col = part, into = c("pt", "no"), sep = " ") %>% 
  mutate(no = as.numeric(no))
```

## Counts of words

```{r}
sherlock_tokens <- sherlock_df %>% 
  unnest_tokens(word, text_full) %>% 
  select(-sherlock_text)

# Counts
sherlock_wordcount <- sherlock_tokens %>% 
  count(no, word)
```

## Removing stop words

```{r}
sherlock_nonstop_words <- sherlock_tokens %>% 
  anti_join(stop_words)

nonstop_counts <- sherlock_nonstop_words %>% 
  count(no, word)
```

## Counts of most frequent words by part

```{r}
top_10_words <- nonstop_counts %>% 
  group_by(no) %>% 
  arrange(-n) %>% 
  slice(1:10)

# Plot
ggplot(data = top_10_words, aes(x = word, y = n)) +
  geom_col(fill = "darkgreen") +
  facet_wrap(~ no, scales = "free") +
  labs(x = "Word",
       y = "Number",
       title = "Top 10 words per part in Sherlock Holmes by Sir Arthur Conan Doyle") +
  coord_flip() +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.title = element_text(size = 12, face = "bold", color = "black"),
        axis.text = element_text(size = 10, color = "gray19"),
        strip.background = element_rect(fill = "white"),
        strip.text = element_text(size = 12, face = "bold", color = "black"))
```

## Wordcloud

```{r, include = FALSE}
# Make this wordcloud by chapter and then put them together with patchwork
#sherlock_cloud <- ggplot(data = nonstop_counts,
#                        aes(label = word)) +
# geom_text_wordcloud(aes(color = n, size = n), shape = "diamond") +
#  scale_size_area(max_size = 6) +
#  scale_color_gradientn(colors = c("darkgreen", "blue", "purple")) +
#  theme_bw()

#sherlock_cloud
```


## Sentiment analysis

```{r}
sherlock_afinn <- sherlock_nonstop_words %>% 
  inner_join(get_sentiments("afinn"))
```

## Counts

```{r}
afinn_counts <- sherlock_afinn %>% 
  count(no, value)

# Plot
ggplot(data = afinn_counts, aes(x = value, y = n)) +
  geom_col() +
  facet_wrap(~ no)
```

## Mean afinn scores per part

```{r}
afinn_means <- sherlock_afinn %>% 
  group_by(no) %>% 
  summarise(mean_afinn = mean(value))


ggplot(data = afinn_means, aes(x = fct_rev(as.factor(no)),
                               y = mean_afinn)) +
  geom_col() +
  coord_flip()
```


## NRC

```{r}
sherlock_nrc <- sherlock_nonstop_words %>% 
  inner_join(get_sentiments("nrc"))
```

```{r}
sherlock_nrc_counts <- sherlock_nrc %>% 
  count(no, sentiment)

ggplot(data = sherlock_nrc_counts, aes(x = sentiment, y = n)) +
  geom_col() +
  facet_wrap(~ no) +
  coord_flip()
```

## Bing

```{r}
sherlock_bing <- sherlock_nonstop_words %>% 
  inner_join(get_sentiments("bing"))

# Counts
sherlock_bing_counts <- sherlock_bing %>% 
  count(no, sentiment)

# Plot
ggplot(data = sherlock_bing_counts, aes(x = sentiment, y = n)) +
  geom_col() +
  facet_wrap(~ no) +
  coord_flip()
```



















## Citation: Doyle, AC (1892) The Adventures of Sherlock Holmes. *INCLUDE PUBLISHER*


















